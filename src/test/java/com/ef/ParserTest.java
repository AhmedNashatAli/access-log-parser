package  com.ef;

import org.junit.Before;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static org.junit.Assert.assertArrayEquals;
import static org.junit.Assert.assertEquals;

public class ParserTest{
    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();
    private final ByteArrayOutputStream errContent = new ByteArrayOutputStream();
    private String accessLogPath;

    @Before
    public void setUpStreams() {
        System.setOut(new PrintStream(outContent));
        System.setErr(new PrintStream(errContent));
        ClassLoader loader = ParserTest.class.getClassLoader();
        accessLogPath= ParserTest.class.getResource("access.log").getFile();
        accessLogPath=accessLogPath.indexOf(":")!=-1?accessLogPath.substring(1):accessLogPath;
    }

    @Test
    public void testParserWithAllParametersHourlyHappyScenario() {
        //"java -cp \"parser.jar\" com.ef.Parser --startDate=2017-01-01.13:00:00 --duration=hourly --threshold=100"
        //java -cp target/parser.jar com.ef.Parser --accesslog=C:\Users\tgxt3353\Desktop\tmp\walethub\access.log --startDate=2017-01-01.13:00:00 --duration=hourly --threshold=100
         Parser.main(new String[]{" --accesslog="+accessLogPath,"--startDate=2017-01-01.23:59:41","--duration=hourly","--threshold=3"});
         assertEquals("192.168.122.135",  outContent.toString().trim());
    }

    @Test
    public void testParserWithAllParametersDailyEmpty() {
        Parser.main(new String[]{" --accesslog="+accessLogPath,"--startDate=2017-01-01.00:59:41","--duration=daily","--threshold=1000"});
         assertEquals("",  outContent.toString().trim());
    }

    @Test
    public void testParserWithAllParametersDailyThreshold() {
        Parser.main(new String[]{" --accesslog="+accessLogPath,"--startDate=2017-01-01.00:59:41","--duration=daily","--threshold=600"});
         assertEquals("192.168.143.177192.168.129.191192.168.38.77192.168.199.209",
                 outContent.toString().replaceAll("\\r|\\n", ""));
    }

    @Test
    public void testParserWithMissingStartDateParameter() {
        Parser.main(new String[]{" --accesslog="+accessLogPath,"--duration=daily","--threshold=600"});
         assertEquals("",outContent.toString());
    }

    @Test
    public void testParserWithMissingDurationParameter() {
        Parser.main(new String[]{" --accesslog="+accessLogPath,"--startDate=2017-01-01.00:59:41","--threshold=600"});
        assertEquals("192.168.143.177192.168.129.191192.168.38.77192.168.199.209",
                outContent.toString().replaceAll("\\r|\\n", ""));
    }

    @Test
    public void testParserWithMissingThresholdParameter() {
        Parser.main(new String[]{" --accesslog="+accessLogPath,"--startDate=2017-01-01.00:59:41","--duration=daily"});
        assertEquals("192.168.97.208192.168.150.133192.168.48.97192.168.51.20192.168.114.75192.168.228.84192.168.173.240192.168.110.221192.168.110.220192.168.13.178192.168.181.233192.168.173.244192.168.92.194192.168.102.94192.168.38.45192.168.2.141192.168.188.114192.168.95.89192.168.95.85192.168.224.195192.168.73.68192.168.206.62192.168.76.185192.168.83.91192.168.13.189192.168.181.223192.168.19.247192.168.19.246192.168.215.138192.168.92.183192.168.90.115192.168.230.102192.168.212.1192.168.4.52192.168.143.161192.168.142.154192.168.50.212192.168.151.37192.168.19.217192.168.134.160192.168.104.10192.168.63.32192.168.75.132192.168.251.79192.168.165.220192.168.232.165192.168.197.181192.168.207.171192.168.34.225192.168.114.46192.168.67.131192.168.142.147192.168.43.246192.168.91.178192.168.2.96192.168.19.224192.168.60.254192.168.19.222192.168.148.233192.168.128.31192.168.14.80192.168.143.177192.168.253.25192.168.152.183192.168.124.74192.168.255.244192.168.224.147192.168.185.75192.168.87.21192.168.7.201192.168.165.209192.168.36.235192.168.135.144192.168.18.234192.168.58.90192.168.8.238192.168.206.25192.168.253.13192.168.149.215192.168.155.204192.168.229.251192.168.129.3192.168.51.205192.168.93.184192.168.24.92192.168.112.88192.168.206.22192.168.241.25192.168.14.26192.168.172.249192.168.215.179192.168.172.241192.168.36.240192.168.251.41192.168.38.8192.168.75.58192.168.91.121192.168.114.17192.168.142.190192.168.87.47192.168.74.116192.168.188.135192.168.135.169192.168.230.117192.168.204.91192.168.142.193192.168.35.219192.168.218.27192.168.48.21192.168.27.7192.168.99.18192.168.85.96192.168.14.43192.168.20.113192.168.215.195192.168.97.71192.168.251.46192.168.18.225192.168.100.88192.168.97.74192.168.222.175192.168.88.242192.168.120.236192.168.116.130192.168.199.39192.168.201.232192.168.109.179192.168.87.63192.168.112.49192.168.109.184192.168.34.88192.168.100.228192.168.238.52192.168.221.132192.168.4.158192.168.141.62192.168.46.63192.168.191.235192.168.222.163192.168.143.117192.168.221.128192.168.92.100192.168.171.244192.168.221.120192.168.230.188192.168.238.69192.168.122.77192.168.159.230192.168.5.170192.168.97.7192.168.218.174192.168.112.36192.168.170.200192.168.117.162192.168.145.172192.168.135.121192.168.108.147192.168.208.113192.168.92.117192.168.120.246192.168.109.93192.168.209.158192.168.12.68192.168.178.118192.168.216.33192.168.12.61192.168.30.133192.168.214.92192.168.117.154192.168.31.166192.168.137.186192.168.66.186192.168.200.233192.168.155.18192.168.157.207192.168.112.13192.168.217.195192.168.164.243192.168.58.12192.168.158.252192.168.90.35192.168.191.200192.168.116.183192.168.100.18192.168.46.21192.168.216.135192.168.170.217192.168.190.15192.168.5.149192.168.224.77192.168.143.159192.168.236.83192.168.38.236192.168.121.253192.168.67.28192.168.87.227192.168.109.75192.168.250.130192.168.73.195192.168.177.62192.168.120.98192.168.187.167192.168.138.175192.168.165.84192.168.216.163192.168.120.213192.168.143.51192.168.204.19192.168.43.210192.168.155.39192.168.94.170192.168.15.206192.168.215.124192.168.155.43192.168.215.120192.168.90.55192.168.34.20192.168.115.115192.168.44.78192.168.142.107192.168.204.26192.168.10.85192.168.223.175192.168.192.248192.168.30.171192.168.197.5192.168.197.7192.168.179.109192.168.137.141192.168.243.241192.168.72.173192.168.144.42192.168.94.110192.168.249.215192.168.193.138192.168.227.152192.168.246.75192.168.77.9192.168.55.67192.168.63.250192.168.251.152192.168.33.37192.168.130.6192.168.68.22192.168.114.124192.168.129.104192.168.236.30192.168.186.187192.168.234.239192.168.130.245192.168.46.208192.168.169.144192.168.200.81192.168.21.63192.168.122.135192.168.24.157192.168.129.102192.168.226.103192.168.154.86192.168.145.222192.168.134.14192.168.91.36192.168.87.146192.168.243.147192.168.176.231192.168.178.39192.168.55.45192.168.186.161192.168.194.155192.168.33.16192.168.218.208192.168.194.151192.168.145.211192.168.186.166192.168.145.216192.168.168.28192.168.40.115192.168.130.226192.168.236.16192.168.169.167192.168.131.251192.168.170.159192.168.39.120192.168.129.122192.168.132.98192.168.108.40192.168.234.82192.168.95.151192.168.81.13192.168.185.140192.168.55.32192.168.94.119192.168.169.178192.168.18.88192.168.75.4192.168.0.64192.168.95.122192.168.40.2192.168.71.179192.168.180.194192.168.156.72192.168.70.119192.168.138.121192.168.144.233192.168.243.182192.168.167.9192.168.70.134192.168.10.156192.168.39.103192.168.146.38192.168.24.118192.168.185.164192.168.253.195192.168.162.224192.168.242.147192.168.234.207192.168.124.165192.168.181.38192.168.85.118192.168.21.26192.168.53.68192.168.168.79192.168.114.181192.168.129.170192.168.252.133192.168.154.5192.168.246.14192.168.11.186192.168.71.198192.168.202.228192.168.202.227192.168.218.249192.168.26.180192.168.200.61192.168.161.217192.168.10.135192.168.68.90192.168.0.182192.168.112.109192.168.31.251192.168.244.83192.168.96.153192.168.78.225192.168.176.203192.168.196.198192.168.158.18192.168.159.200192.168.144.215192.168.217.218192.168.41.70192.168.88.0192.168.178.95192.168.106.64192.168.113.134192.168.156.86192.168.162.248192.168.181.12192.168.46.233192.168.178.1192.168.181.13192.168.180.161192.168.48.218192.168.252.114192.168.69.152192.168.146.66192.168.254.95192.168.213.131192.168.213.132192.168.146.67192.168.129.191192.168.41.60192.168.204.209192.168.242.195192.168.253.164192.168.132.251192.168.81.86192.168.134.87192.168.33.222192.168.41.64192.168.232.76192.168.124.132192.168.82.181192.168.141.175192.168.93.62192.168.58.177192.168.69.141192.168.10.116192.168.48.200192.168.61.234192.168.61.232192.168.31.26192.168.209.52192.168.183.14192.168.81.78192.168.25.118192.168.183.19192.168.81.134192.168.14.145192.168.51.91192.168.71.50192.168.254.78192.168.53.26192.168.116.74192.168.118.10192.168.205.236192.168.5.4192.168.155.133192.168.56.112192.168.244.37192.168.228.143192.168.82.168192.168.158.78192.168.106.33192.168.210.146192.168.181.41192.168.97.152192.168.240.122192.168.210.142192.168.209.61192.168.76.203192.168.152.128192.168.253.148192.168.27.174192.168.167.110192.168.182.103192.168.193.20192.168.252.104192.168.40.198192.168.41.139192.168.110.158192.168.54.139192.168.252.106192.168.28.114192.168.56.125192.168.244.47192.168.82.149192.168.181.166192.168.41.143192.168.205.218192.168.97.140192.168.209.74192.168.154.109192.168.106.29192.168.93.78192.168.7.23192.168.5.87192.168.106.26192.168.182.114192.168.229.98192.168.1.137192.168.254.165192.168.136.1192.168.62.247192.168.174.244192.168.98.175192.168.118.220192.168.103.232192.168.118.223192.168.85.191192.168.106.10192.168.106.11192.168.41.23192.168.97.132192.168.61.34192.168.136.66192.168.128.190192.168.225.111192.168.7.93192.168.197.112192.168.180.110192.168.173.206192.168.198.169192.168.51.57192.168.75.216192.168.195.29192.168.148.58192.168.2.190192.168.51.54192.168.213.188192.168.189.223192.168.47.202192.168.209.12192.168.97.116192.168.125.121192.168.181.148192.168.112.165192.168.220.33192.168.199.198192.168.41.13192.168.232.40192.168.104.68192.168.55.153192.168.169.116192.168.195.31192.168.210.2192.168.97.108192.168.3.4192.168.181.136192.168.232.249192.168.160.247192.168.12.149192.168.228.188192.168.230.70192.168.247.235192.168.247.233192.168.136.80192.168.209.39192.168.168.104192.168.219.208192.168.232.17192.168.99.166192.168.168.105192.168.219.60192.168.168.108192.168.112.184192.168.61.250192.168.1.142192.168.226.123192.168.212.163192.168.38.77192.168.154.143192.168.98.136192.168.55.138192.168.230.48192.168.96.56192.168.229.53192.168.44.163192.168.43.113192.168.25.93192.168.160.91192.168.27.111192.168.173.123192.168.66.213192.168.219.10192.168.111.153192.168.120.190192.168.90.220192.168.27.46192.168.149.68192.168.254.111192.168.117.209192.168.142.242192.168.113.97192.168.52.171192.168.44.147192.168.242.44192.168.158.186192.168.120.181192.168.113.80192.168.246.102192.168.196.29192.168.98.15192.168.45.185192.168.174.145192.168.237.100192.168.162.51192.168.84.90192.168.196.204192.168.103.135192.168.127.51192.168.220.15192.168.111.178192.168.111.173192.168.3.74192.168.230.32192.168.36.173192.168.61.170192.168.43.129192.168.109.209192.168.125.59192.168.50.21192.168.1.227192.168.125.54192.168.229.112192.168.231.243192.168.113.77192.168.52.153192.168.190.173192.168.44.168192.168.139.49192.168.74.201192.168.74.200192.168.61.169192.168.229.103192.168.252.58192.168.57.203192.168.172.116192.168.226.6192.168.127.75192.168.173.165192.168.186.37192.168.245.128192.168.73.221192.168.134.225192.168.191.168192.168.42.104192.168.96.86192.168.83.210192.168.101.114192.168.246.179192.168.101.116192.168.229.132192.168.120.143192.168.125.32192.168.152.12192.168.190.111192.168.25.60192.168.172.127192.168.166.130192.168.91.233192.168.240.65192.168.59.53192.168.217.22192.168.127.83192.168.101.70192.168.176.12192.168.217.28192.168.21.251192.168.192.190192.168.7.2192.168.91.247192.168.86.72192.168.152.50192.168.247.190192.168.73.200192.168.174.182192.168.5.50192.168.102.136192.168.98.54192.168.223.203192.168.187.211192.168.103.165192.168.250.82192.168.205.71192.168.150.209192.168.162.86192.168.245.109192.168.157.178192.168.207.249192.168.89.111192.168.151.234192.168.151.239192.168.101.54192.168.25.12192.168.225.96192.168.142.23192.168.225.93192.168.96.7192.168.120.116192.168.120.119192.168.107.211192.168.22.253192.168.89.166192.168.135.224192.168.139.99192.168.236.127192.168.21.200192.168.191.115192.168.37.114192.168.88.135192.168.228.5192.168.129.60192.168.135.208192.168.240.13192.168.11.75192.168.57.74192.168.135.216192.168.35.66192.168.18.169192.168.39.199192.168.73.238192.168.203.82192.168.35.38192.168.159.115192.168.227.57192.168.13.43192.168.217.10192.168.88.56192.168.102.172192.168.164.146192.168.237.63192.168.198.53192.168.73.243192.168.130.188192.168.33.90192.168.3.211192.168.198.39192.168.6.109192.168.165.192192.168.163.127192.168.176.25192.168.78.15192.168.8.196192.168.246.194192.168.172.148192.168.173.170192.168.203.196192.168.45.70192.168.172.6192.168.6.110192.168.39.178192.168.185.214192.168.159.170192.168.178.18192.168.142.64192.168.45.66192.168.132.18192.168.159.178192.168.185.216192.168.172.192192.168.221.214192.168.158.130192.168.238.177192.168.221.210192.168.165.171192.168.171.164192.168.121.70192.168.192.141192.168.213.62192.168.215.214192.168.237.56192.168.178.33192.168.23.12192.168.150.9192.168.247.64192.168.170.128192.168.80.199192.168.101.161192.168.136.242192.168.3.29192.168.101.165192.168.114.222192.168.16.120192.168.91.24192.168.191.100192.168.115.235192.168.236.106192.168.193.152192.168.1.94192.168.5.241192.168.23.23192.168.214.201192.168.17.140192.168.159.166192.168.136.230192.168.66.72192.168.170.115192.168.174.2192.168.188.49192.168.243.125192.168.172.187192.168.215.23192.168.190.62192.168.94.231192.168.44.53192.168.153.8192.168.185.253192.168.79.39192.168.67.53192.168.218.110192.168.235.156192.168.204.175192.168.130.128192.168.234.110192.168.192.213192.168.5.107192.168.211.90192.168.242.234192.168.109.43192.168.44.56192.168.199.209192.168.210.205192.168.145.25192.168.106.134192.168.161.112192.168.89.70192.168.79.49192.168.89.74192.168.15.217192.168.43.1192.168.162.142192.168.109.31192.168.155.58192.168.107.96192.168.90.63192.168.237.15192.168.219.154192.168.235.173192.168.19.70192.168.32.121192.168.128.207192.168.220.187192.168.176.115192.168.78.4192.168.226.209192.168.235.178192.168.211.229192.168.143.90192.168.177.72192.168.133.56192.168.10.53192.168.131.140192.168.85.202192.168.44.36192.168.119.60192.168.55.224192.168.15.232192.168.203.111192.168.42.81192.168.77.101192.168.86.246192.168.247.30192.168.119.58192.168.223.82192.168.105.111192.168.162.162192.168.129.243192.168.33.154192.168.22.13192.168.107.182192.168.64.193192.168.251.0192.168.90.80192.168.79.186192.168.70.21192.168.130.161192.168.47.178192.168.29.98192.168.220.121192.168.123.241192.168.179.79192.168.63.1192.168.46.124192.168.233.88192.168.237.191192.168.198.201192.168.169.10192.168.211.39192.168.85.243192.168.87.4192.168.50.184192.168.1.17192.168.70.37192.168.201.11192.168.155.96192.168.223.17192.168.32.31192.168.177.0192.168.54.43192.168.227.219192.168.46.138192.168.85.237192.168.32.182192.168.128.220192.168.47.150192.168.29.79192.168.117.89192.168.145.75192.168.147.11192.168.29.78192.168.146.174192.168.131.185192.168.145.131192.168.63.101192.168.242.3192.168.25.244192.168.29.222192.168.39.201192.168.65.195192.168.233.71192.168.30.72192.168.236.174192.168.63.117192.168.82.23192.168.42.44192.168.14.241192.168.107.36192.168.157.9192.168.12.6192.168.17.74192.168.140.249192.168.19.14192.168.105.169192.168.80.215192.168.99.217192.168.12.4192.168.180.98192.168.41.232192.168.240.226192.168.240.221192.168.60.28192.168.151.229192.168.62.176192.168.147.126192.168.10.251192.168.53.250192.168.146.6192.168.29.69192.168.47.8192.168.133.187192.168.255.72192.168.182.51192.168.194.224192.168.68.237192.168.182.42192.168.52.206192.168.4.9192.168.179.4192.168.206.198192.168.107.16192.168.197.202192.168.233.16192.168.170.37192.168.69.252192.168.29.34192.168.224.201192.168.29.31192.168.223.13192.168.42.19192.168.240.247192.168.167.234192.168.243.64192.168.151.207192.168.42.11192.168.96.211192.168.152.243192.168.182.222192.168.115.92192.168.69.244192.168.56.240192.168.17.67192.168.169.75192.168.160.10192.168.147.152192.168.40.63192.168.105.59192.168.53.223192.168.167.222192.168.148.190192.168.231.58192.168.174.125192.168.72.43192.168.248.171192.168.69.231192.168.50.97192.168.78.152192.168.63.175192.168.82.96192.168.162.199192.168.137.38192.168.247.138192.168.52.30192.168.50.94192.168.206.141192.168.81.223192.168.119.134192.168.231.69192.168.131.112192.168.77.125192.168.110.255192.168.91.198192.168.208.46192.168.30.14192.168.11.231192.168.125.240192.168.184.25192.168.49.164192.168.8.57192.168.90.158192.168.111.241192.168.77.135192.168.27.56192.168.48.112192.168.106.181192.168.177.190192.168.0.237192.168.160.64192.168.111.253192.168.132.119192.168.219.100192.168.127.16192.168.81.202192.168.247.110192.168.49.151192.168.159.84192.168.69.7192.168.150.12192.168.11.216192.168.196.232192.168.110.235192.168.248.147192.168.11.214192.168.27.60192.168.149.43192.168.84.48192.168.15.96192.168.170.92192.168.105.15192.168.170.93",
                outContent.toString().replaceAll("\\r|\\n", ""));
    }

    @Test
    public void testParserWithMissingAllParameters() {
        Parser.main(new String[]{" --accesslog="+accessLogPath});
        assertEquals("",outContent.toString());
    }
}